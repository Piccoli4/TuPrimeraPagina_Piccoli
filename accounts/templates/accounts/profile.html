{% extends 'base.html' %}

{% block title %}Mi Perfil - Pilates Gravity{% endblock %}

{% block content %}

    <!-- Mostrar solo mensajes relacionados con perfil -->
    {% if messages %}
        {% for message in messages %}
            {% if "perfil" in message.message|lower or "actualizado" in message.message|lower or "guardado" in message.message|lower or "modificado" in message.message|lower or "cambiado" in message.message|lower %}
                <div class="profile-alert profile-alert-{{ message.tags }} profile-fade-in">
                    {{ message }}
                    <button type="button" class="profile-alert-close" onclick="this.parentElement.style.display='none'">X</button>
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}

    <!-- Secci√≥n del perfil integrada con el sitio -->
    <section class="profile-section" id="Profile">
        <div class="container">
            
            <div class="section-title">
                <h2>Mi Perfil</h2>
                <div class="divider"></div>
                <p>Gestiona tu informaci√≥n personal y configuraci√≥n de cuenta</p>
            </div>

            <div class="profile-main-content">
                
                <!-- Tarjeta principal del perfil -->
                <div class="profile-user-card">
                    <div class="profile-avatar">
                        {% if user_profile and user_profile.avatar %}
                            <img src="{{ user_profile.avatar.url }}" alt="Avatar actual">
                        {% else %}
                            {{ user.first_name.0|upper }}{{ user.last_name.0|upper }}
                        {% endif %}
                    </div>
                    <div class="profile-user-info">
                        <h3 class="profile-username">
                            {% if user.first_name and user.last_name %}
                                {{ user.first_name }} {{ user.last_name }}
                            {% elif user.first_name %}
                                {{ user.first_name }}
                            {% elif user.last_name %}
                                {{ user.last_name }}
                            {% else %}
                                {{ user.username }}
                            {% endif %}
                        </h3>
                        <p class="profile-handle">@{{ user.username }}</p>
                        <small class="profile-member-since">Miembro desde {{ user.date_joined|date:"F Y" }}</small>
                    </div>
                    
                    <!-- Estad√≠sticas del usuario -->
                    {% if user_profile %}
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-number">{{ user_profile.get_total_reservas }}</span>
                            <span class="stat-label">Reservas</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">{{ user_profile.get_reservas_activas.count }}</span>
                            <span class="stat-label">Activas</span>
                        </div>
                        {% if user_profile.get_tiempo_en_estudio %}
                        <div class="stat-item">
                            <span class="stat-number">{{ user_profile.get_tiempo_en_estudio }}</span>
                            <span class="stat-label">En el estudio</span>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>

                <!-- Navegaci√≥n r√°pida del perfil -->
                <div class="profile-quick-nav">
                    <a href="{% url 'accounts:profile_complete' %}" class="profile-nav-card">
                        <div class="nav-icon-wrapper">
                            <span class="nav-icon">üéØ</span>
                        </div>
                        <div class="nav-content">
                            <h4>Completar Perfil</h4>
                            <p>Informaci√≥n paso a paso</p>
                        </div>
                        <span class="nav-arrow">‚Üí</span>
                    </a>
                    
                    <a href="{% url 'accounts:cambiar_password' %}" class="profile-nav-card">
                        <div class="nav-icon-wrapper">
                            <span class="nav-icon">üîí</span>
                        </div>
                        <div class="nav-content">
                            <h4>Cambiar Contrase√±a</h4>
                            <p>Seguridad de cuenta</p>
                        </div>
                        <span class="nav-arrow">‚Üí</span>
                    </a>
                </div>

                <!-- Formulario de informaci√≥n b√°sica -->
                <div class="profile-form-container">
                    <div class="profile-form-header">
                        <h3>Informaci√≥n B√°sica</h3>
                        <p>Actualiza tus datos personales</p>
                    </div>
                    
                    <form method="post" class="profile-basic-form">
                        {% csrf_token %}
                        
                        <div class="profile-form-grid">
                            <div class="profile-field-group">
                                <label for="id_first_name" class="profile-field-label">
                                    <span class="field-icon">üë§</span>
                                    Nombre
                                </label>
                                <div class="profile-input-container">
                                    {{ form.first_name }}
                                    <div class="field-focus-line"></div>
                                </div>
                                {% if form.first_name.errors %}
                                    <div class="profile-field-error">
                                        {% for error in form.first_name.errors %}
                                            <span class="error-text">‚ö†Ô∏è {{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="profile-field-group">
                                <label for="id_last_name" class="profile-field-label">
                                    <span class="field-icon">üë§</span>
                                    Apellido
                                </label>
                                <div class="profile-input-container">
                                    {{ form.last_name }}
                                    <div class="field-focus-line"></div>
                                </div>
                                {% if form.last_name.errors %}
                                    <div class="profile-field-error">
                                        {% for error in form.last_name.errors %}
                                            <span class="error-text">‚ö†Ô∏è {{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="profile-field-group">
                                <label for="id_telefono" class="profile-field-label">
                                    <span class="field-icon">üìû</span>
                                    Tel√©fono
                                </label>
                                <div class="profile-input-container">
                                    {{ form.telefono }}
                                    <div class="field-focus-line"></div>
                                </div>
                                {% if form.telefono.errors %}
                                    <div class="profile-field-error">
                                        {% for error in form.telefono.errors %}
                                            <span class="error-text">‚ö†Ô∏è {{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                {% if form.telefono.help_text %}
                                    <div class="profile-field-help">{{ form.telefono.help_text }}</div>
                                {% endif %}
                            </div>

                            <div class="profile-field-group">
                                <label for="id_email" class="profile-field-label">
                                    <span class="field-icon">üìß</span>
                                    Email
                                </label>
                                <div class="profile-input-container">
                                    {{ form.email }}
                                    <div class="field-focus-line"></div>
                                </div>
                                {% if form.email.errors %}
                                    <div class="profile-field-error">
                                        {% for error in form.email.errors %}
                                            <span class="error-text">‚ö†Ô∏è {{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="profile-form-actions">
                            <button type="submit" class="profile-update-btn">
                                <span class="btn-text">Actualizar Perfil</span>
                                <span class="btn-icon">üíæ</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Enlaces adicionales -->
                <div class="profile-additional-links">
                    <a href="{% url 'accounts:logout' %}" class="profile-logout-btn">
                        <span class="logout-icon">üö™</span>
                        Cerrar Sesi√≥n
                    </a>
                </div>
            
            </div>
        </div>
    </section>

    <script>
        // Animaciones y efectos para el perfil
        document.addEventListener('DOMContentLoaded', function() {
            // Animaci√≥n de entrada
            const elements = document.querySelectorAll('.profile-user-card, .profile-nav-card, .profile-form-container');
            elements.forEach((element, index) => {
                element.style.opacity = '0';
                element.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    element.style.transition = 'all 0.6s ease';
                    element.style.opacity = '1';
                    element.style.transform = 'translateY(0)';
                }, 200 * index);
            });

            // Efecto hover en estad√≠sticas
            const statItems = document.querySelectorAll('.stat-item');
            statItems.forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px) scale(1.05)';
                });
                item.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });

            // Auto-hide de alertas despu√©s de 5 segundos
            const alerts = document.querySelectorAll('.profile-alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.opacity = '0';
                    setTimeout(() => {
                        alert.remove();
                    }, 300);
                }, 5000);
            });
        });
    </script>
    
{% endblock %}